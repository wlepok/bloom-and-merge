<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloom & Merge</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .inventory {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            gap: 10px;
            margin-top: 20px;
        }
        .item {
            width: 100px;
            height: 100px;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: move;
            user-select: none;
        }
        .item.drag-over {
            border-color: #00ff00;
        }
        #score {
            font-size: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Bloom & Merge</h1>
    <div class="inventory" id="inventory"></div>
    <div id="score">Score: 0</div>

    <script>
        // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ°
        let inventory = [1, 1, 1]; // ðŸŒ± Tiny Seed x3
        let score = 0;
        const items = {
            1: "ðŸŒ± Tiny Seed",
            2: "ðŸŒ¼ Bud",
            3: "ðŸŒ¸ Bloom",
            4: "ðŸŒ³ Flower Tree",
            5: "ðŸ¡ Blossom Haven"
        };

        // ÐžÑ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ° Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ñ
        function renderInventory() {
            const inventoryDiv = document.getElementById("inventory");
            inventoryDiv.innerHTML = "";
            inventory.forEach((item, index) => {
                const itemDiv = document.createElement("div");
                itemDiv.className = "item";
                itemDiv.textContent = items[item];
                itemDiv.dataset.index = index;
                itemDiv.draggable = true;
                inventoryDiv.appendChild(itemDiv);
            });
            document.getElementById("score").textContent = `Score: ${score}`;
            addDragAndDropListeners();
        }

        // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² drag-and-drop
        function addDragAndDropListeners() {
            const items = document.querySelectorAll(".item");
            items.forEach(item => {
                item.addEventListener("dragstart", (e) => {
                    e.dataTransfer.setData("text/plain", item.dataset.index);
                });

                item.addEventListener("dragover", (e) => {
                    e.preventDefault();
                    item.classList.add("drag-over");
                });

                item.addEventListener("dragleave", () => {
                    item.classList.remove("drag-over");
                });

                item.addEventListener("drop", (e) => {
                    e.preventDefault();
                    item.classList.remove("drag-over");
                    const fromIndex = parseInt(e.dataTransfer.getData("text/plain"));
                    const toIndex = parseInt(item.dataset.index);
                    mergeItems(fromIndex, toIndex);
                });
            });
        }

        // Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð¾Ð²
        function mergeItems(fromIndex, toIndex) {
            if (fromIndex === toIndex || fromIndex >= inventory.length || toIndex >= inventory.length) {
                return;
            }

            const item1 = inventory[fromIndex];
            const item2 = inventory[toIndex];

            if (item1 !== item2) {
                alert("You can only merge identical items!");
                return;
            }

            const newItem = item1 < 5 ? item1 + 1 : 5;
            inventory.splice(Math.max(fromIndex, toIndex), 1);
            inventory.splice(Math.min(fromIndex, toIndex), 1);
            inventory.push(newItem);
            score += newItem * 10;

            // ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð±Ð¾Ñ‚Ñƒ
            tg.sendData(JSON.stringify({
                action: "merge",
                index1: fromIndex,
                index2: toIndex
            }));

            renderInventory();
        }

        // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð³Ñ€Ñ‹
        renderInventory();

        // Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Web App
        tg.MainButton.setText("Close").show().onClick(() => {
            tg.close();
        });
    </script>
</body>
</html>